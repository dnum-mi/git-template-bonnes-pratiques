name: Build and push Docker image Back-End and Front-end
on:  
  push:    
    branches:      
    - init-pipeline
jobs:  
  build-and-push:    
    runs-on: ubuntu-latest    
    steps:      
    - name: Checkout code        
      uses: actions/checkout@v2      
      
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
      
    - name: Build and push Docker image back-end        
      uses: docker/build-push-action@v4        
      with:          
        context: ./learngithub          
        push: false          
        tags: sample-image-back-end:v1
        outputs: type=docker,dest=/tmp/sample-image-back-end-v1.tar
        
    - name: Upload artifact back-end
      uses: actions/upload-artifact@v3
      with:
        name: sample-image-back-end
        path: /tmp/sample-image-back-end-v1.tar
    - name: Build and push Docker image front-end        
      uses: docker/build-push-action@v4        
      with:          
        context: ./front-end          
        push: false          
        tags: sample-image-front-end:v1
        outputs: type=docker,dest=/tmp/sample-image-front-end-v1.tar
        
    - name: Upload artifact front-end
      uses: actions/upload-artifact@v3
      with:
        name: sample-image-front-end
        path: /tmp/sample-image-front-end-v1.tar
